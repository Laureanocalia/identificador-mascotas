<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Identificador de Mascotas</title>
</head>
<body>

  <h2>Identificador de Mascotas </h2>

  <input type="text" id="codigo" placeholder="Ingres谩 el c贸digo">
  <button id="btnConsultar">Consultar</button>

  <div id="resultado">Esperando...</div>

  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzUu82duUb3kuG5ej2HgrZz3AZ5mvzLfRuSNgIlGRmzP3mgGrCo3m5VJys4doGj_169og/exec";

  function validar() {
    console.log("VALIDAR EJECUTADA");

    const codigo = document.getElementById("codigo").value.trim();
    const resultado = document.getElementById("resultado");

    if (!codigo) {
      resultado.textContent = "Ingres谩 un c贸digo.";
      return;
    }

    resultado.textContent = "Consultando...";

    // eliminar script previo si existe
    const oldScript = document.getElementById("jsonp");
    if (oldScript) oldScript.remove();

    // crear script JSONP
    const script = document.createElement("script");
    script.id = "jsonp";
    script.src = API_URL +
      "?code=" + encodeURIComponent(codigo) +
      "&callback=procesarRespuesta";

    document.body.appendChild(script);
  }

  function procesarRespuesta(data) {
    console.log("DATA:", data);

    const resultado = document.getElementById("resultado");

    if (!data.exists) {
      resultado.textContent = "El c贸digo ingresado no existe.";
      return;
    }

    if (data.status === "NO_ACTIVADO") {
      resultado.textContent = "Este identificador a煤n no est谩 activado.";
      return;
    }

    if (data.status === "ACTIVO") {
      resultado.textContent = "C贸digo ACTIVO";
      return;
    }

    resultado.textContent = "Estado desconocido.";
  }

  document
    .getElementById("btnConsultar")
    .addEventListener("click", validar);
</script>

</body>
</html>
