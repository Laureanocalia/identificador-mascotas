<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Identificador de Mascotas</title>
</head>
<body>

  <h2>Identificador de Mascotas </h2>

  <input type="text" id="codigo" placeholder="Ingres谩 el c贸digo">
  <button id="btnConsultar">Consultar</button>

  <div id="resultado">Esperando...</div>

  <script>
    console.log("SCRIPT CARGADO");

    const API_URL = "https://script.google.com/macros/s/XXXX/exec";

    // Esperamos a que el DOM est茅 listo
    document.getElementById("btnConsultar").addEventListener("click", validar);

    function validar() {
      console.log("VALIDAR EJECUTADA");

      const codigoInput = document.getElementById("codigo");
      const resultado = document.getElementById("resultado");

      if (!codigoInput || !resultado) {
        console.error("Elementos no encontrados en el DOM");
        return;
      }

      const codigo = codigoInput.value.trim();

      if (!codigo) {
        resultado.textContent = "Ingres谩 un c贸digo.";
        return;
      }

      resultado.textContent = "Consultando...";

      fetch(API_URL + "?code=" + encodeURIComponent(codigo))
        .then(res => res.json())
        .then(data => {
          console.log("DATA:", data);

          if (!data.exists) {
            resultado.textContent = "El c贸digo ingresado no existe.";
            return;
          }

          if (data.status === "NO_ACTIVADO") {
            resultado.textContent = "Este identificador a煤n no est谩 activado.";
            return;
          }

          if (data.status === "ACTIVO") {
            resultado.textContent = "C贸digo ACTIVO (pr贸ximo paso)";
            return;
          }

          resultado.textContent = "Estado desconocido.";
        })
        .catch(err => {
          console.error(err);
          resultado.textContent = "Error al consultar el c贸digo.";
        });
    }
  </script>

</body>
</html>
